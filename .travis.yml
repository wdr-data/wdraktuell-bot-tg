language: node_js

sudo: false

node_js:
  - 12

env:
  global:
    - ENV_BUCKET_NAME=wdraktuell-bot-tg-env
    - AWS_REGION=eu-central-1

cache: yarn

before_script:
  - ./config/prepare-ci.js

script: echo "No tests yet :/"

deploy:
  - provider: script
    skip_cleanup: true
    script: export SLS_STAGE=staging && yarn serverless create_domain && yarn serverless deploy && ./setWebhook.sh
    on:
      branch: master
  - provider: script
    skip_cleanup: true
    script: export SLS_STAGE=prod && yarn serverless create_domain && yarn serverless deploy
    on:
      branch: production

notifications:
  slack:
    rooms:
      secure: EVgBWH5Ijbic84df4/ARCnE9/94wYXcG66kIGHId4Dtk6GL+oklrfO40i3ksbTy5uhpK4HGNHYDgUbFSxWOE+tD08iGcC5MgngwpESXLajjIyF+Fm8c+5kmcEnG5bQOvv7U6J08UZwMKF1lFIoDe+O1/bjgOLyLY/+hVu0XEzFQ1cARNwKZ1CrdEOqz9r144sMxYNgqj6vtUYbR2xFT0oWCHkowV5rJl34X/KM5Ijzb1bHc9cu0CjMPpi4XwzitBQsX6Jbu0YOAwKVptyivmAuihK4VjP1+G3XQb1Hp6e35WcWZBfF+HMGsBss2TYiqFtYvwk+6o+93cLfWurrIGJBb5fjLrSTQWvnbEdUaDL/rdax30/r28XUkEQUfs84HKJX5tpaaGdfbZMPdcYvpj9/qbTpDVWU3NmBMF214RuYCsFp9FNUt0ToZQLW5hsaosGi9R9FHxxoyevIyev7UCMRVinH7q+7FWtD26LJJEWBHx8hUbvGslHwXth2mFuU9nkF4SwBdRNh+VZX8BbF1xXxyi3sBe62Chm3OhGHzjpvqjbpWvd45Zc2wH9vzrDRx19nIZ2Os6FPhkd7i4BJoG+Hov4cvQZGbcD7lWX+oqwgILz6Rz3F5UHod3sIXx7H4cTWO0YRbrRJk3p3RyMH3Eqz+sohGWj/6Ilvdlqp6YNBQ=
    on_pull_requests: false
    template:
      - "Deployment %{result}:"
      - "<%{compare_url}|%{repository_slug}:%{branch}#%{commit}> by %{author}"
